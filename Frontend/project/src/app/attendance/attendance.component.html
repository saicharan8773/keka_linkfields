<div class="dashboard-container">
  <app-sidebar></app-sidebar>
  <main class="main-content">
    <div class="attendance-dashboard-container">
      <div class="attendance-cards-row">
        <!-- Time Clock Card -->
        <div class="attendance-card clock-card">
          <div class="card-title-row">
            <span class="card-icon">üïí</span>
            <span class="card-title">Time Clock</span>
          </div>
          <div class="clock-time">
            <span class="big-time">{{ now | date : "HH:mm" }}</span>
            <span class="small-sec">{{ now | date : "ss" }}</span>
          </div>
          <div class="clock-date">{{ now | date : "EEEE, dd MMMM yyyy" }}</div>
          <div class="clock-actions">
            <button (click)="onLogin()" [disabled]="loginSuccess">
              <svg
                class="punch-btn-icon"
                width="20"
                height="20"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                viewBox="0 0 24 24"
              >
                <path d="M5 12h14" />
                <path d="M12 5l7 7-7 7" />
              </svg>
              <span class="punch">Punch In</span>
            </button>
            <button (click)="onLogout()" [disabled]="logoutSuccess">
              <svg
                class="punch-btn-icon"
                width="20"
                height="20"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                viewBox="0 0 24 24"
              >
                <path d="M19 12H5" />
                <path d="M12 19l-7-7 7-7" />
              </svg>
              <span class="punch">Punch Out</span>
            </button>
          </div>
        </div>
        <!-- This Month Card -->
        <div class="attendance-card stats-card">
          <div class="card-title-row">
            <span class="card-icon">üìÖ</span>
            <span class="card-title">This Month</span>
          </div>
          <div class="stats-row">
            <div class="stat-block">
              <div class="stat-value">{{ presentDays }}</div>
              <div class="stat-label">Present Days</div>
            </div>
            <div class="stat-block">
              <div class="stat-value">{{ leaveDays }}</div>
              <div class="stat-label">Leave Days</div>
            </div>
          </div>
          <div class="stats-row">
            <div class="stat-block">
              <div class="stat-value">{{ totalHours }}</div>
              <div class="stat-label">Total Hours</div>
            </div>
            <div class="stat-block">
              <div class="stat-value">{{ avgHours }}</div>
              <div class="stat-label">Avg Hours/Day</div>
            </div>
          </div>
        </div>
        <!-- Leave Request Card -->
        <div class="attendance-card leave-card">
          <div class="card-title-row">
            <span class="card-icon">üìù</span>
            <span class="card-title">Leave Request</span>
          </div>
          <div class="leave-desc">
            Need time off? Submit a leave request to your manager.
          </div>
          <button class="leave-btn" (click)="showLeaveForm = true">
            Request Leave
          </button>
        </div>
      </div>

      <div class="attendance-records-card">
        <div class="records-header-row">
          <div class="records-title">Attendance Records</div>
          <div class="month-selector">
            <label>
              Month:
              <input
                type="month"
                [(ngModel)]="month"
                (change)="loadMonthly()"
              />
            </label>
          </div>
        </div>
        <table class="attendance-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Login (IST)</th>
              <th>Logout (IST)</th>
              <th>Worked Hrs</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let r of pagedData">
              <td>{{ r.date | date : "yyyy-MM-dd" }}</td>
              <td>{{ r.login ? (r.login | date : "HH:mm") : "-" }}</td>
              <td>{{ r.logout ? (r.logout | date : "HH:mm") : "-" }}</td>
              <td>{{ r.workedHours ?? "-" }}</td>
              <td>
                <span
                  class="status-badge"
                  [ngClass]="{
                    present: r.status === 'Present',
                    weekend: r.status === 'Weekend',
                    halfday: r.status === 'Half Day',
                    leave: r.status === 'Leave'
                  }"
                  >{{ r.status }}</span
                >
              </td>
            </tr>
          </tbody>
        </table>
        <div class="pagination-controls" *ngIf="totalPages > 1">
          <button (click)="goToPage(page - 1)" [disabled]="page === 1">
            &laquo; Previous
          </button>
          <span>Page {{ page }} of {{ totalPages }}</span>
          <button (click)="goToPage(page + 1)" [disabled]="page === totalPages">
            Next &raquo;
          </button>
        </div>
      </div>
    </div>
    <div
      class="toast"
      *ngIf="toastMessage"
      [ngClass]="toastType"
      [class.toast-visible]="toastMessage"
    >
      {{ toastMessage }}
    </div>
  </main>
</div>
