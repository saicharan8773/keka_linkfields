<head>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />
</head>

<div class="dashboard-container">
  <app-sidebar></app-sidebar>

  <main class="main-content">
    <div class="employee-container">
      <!-- Header -->
      <div class="page-header">
        <div>
          <h1>Employees</h1>
          <p class="subtitle">Manage your organization’s employees</p>
        </div>
      </div>

      <!-- Search, Filter, Add Button -->
      <div class="search-add-row">
        <div class="search-filter-group">

          <!-- SEARCH -->
          <div class="search-box">
            <input
              type="text"
              placeholder="Search employees…"
              [(ngModel)]="searchText"
              (input)="onSearch()"
            />
          </div>

          <!-- FILTER BUTTON -->
          <div class="filter-wrapper">
            <button class="btn-filter" (click)="toggleFilterPanel()" [class.active]="showFilterPanel">
              <i class="bi bi-funnel"></i> <span>Filter</span>
            </button>

            <!-- FILTER PANEL -->
            <div class="filter-panel" *ngIf="showFilterPanel">
              <div class="filter-header">
                <h3>Filters</h3>
                <button class="close-filter" (click)="toggleFilterPanel()">×</button>
              </div>

              <div class="filter-body">
                <!-- DEPARTMENT -->
                <div class="filter-group">
                  <label>Department</label>
                  <select [(ngModel)]="filterDepartmentId">
                    <option value="">All Departments</option>
                    <option *ngFor="let d of departments" [value]="d.id">
                      {{ d.name }}
                    </option>
                  </select>
                </div>

                <!-- DESIGNATION -->
                <div class="filter-group">
                  <label>Designation</label>
                  <select [(ngModel)]="filterDesignationId">
                    <option value="">All Designations</option>
                    <option *ngFor="let d of designations" [value]="d.id">
                      {{ d.title }}
                    </option>
                  </select>
                </div>

                <!-- LOCATION -->
                <div class="filter-group">
                  <label>Location</label>
                  <select [(ngModel)]="filterLocationId">
                    <option value="">All Locations</option>
                    <option *ngFor="let l of locations" [value]="l.id">
                      {{ l.name }}
                    </option>
                  </select>
                </div>

                <!-- EMPLOYMENT TYPE -->
                <div class="filter-group">
                  <label>Employment Type</label>
                  <select [(ngModel)]="filterEmploymentType">
                    <option value="">All Types</option>
                    <option value="Full-time">Full-time</option>
                    <option value="Part-time">Part-time</option>
                    <option value="Contract">Contract</option>
                    <option value="Intern">Intern</option>
                  </select>
                </div>
              </div>

              <div class="filter-footer">
                <button class="btn-clear" (click)="clearFilters()">Clear</button>
                <button class="btn-apply" (click)="applyFilters()">Apply</button>
              </div>
            </div>
          </div>
        </div>

        <!-- ADD EMPLOYEE BUTTON -->
        <button class="btn-add-gold" (click)="showAddEmployeeModal = true">
          <span class="plus-sign">+</span> Add Employee
        </button>
      </div>

      <!-- EMPLOYEE TABLE -->
      <div class="table-wrapper">
        <table class="employee-table">
          <thead>
            <tr>
              <th>Employee</th>
              <th>Code</th>
              <th>Department</th>
              <th>Designation</th>
              <th>Location</th>
              <th>Type</th>
              <th>Actions</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let employee of employees">
              
              <!-- EMPLOYEE -->
              <td data-label="Employee">
                <div class="emp-profile">
                  <div class="avatar">
                    {{ employee.firstName[0] }}{{ employee.lastName[0] }}
                  </div>
                  <div class="emp-info">
                    <div class="name">
                      {{employee.displayName}}
                    </div>
                    <div class="email">{{ employee.workEmail }}</div>
                  </div>
                </div>
              </td>

              <td data-label="Code">
                <span class="code-tag">{{ employee.employeeCode }}</span>
              </td>

              <td data-label="Department">{{ employee.departmentName }}</td>

              <td data-label="Designation">{{ employee.designationTitle }}</td>

              <td data-label="Location">{{ employee.locationName }}</td>

              <!-- FIXED: SHOW REAL EMPLOYMENT TYPE -->
              <td data-label="Type">
                <span class="type-tag">{{ employee.employmentType || "FT"}}</span>
              </td>

              <!-- ACTIONS -->
              <td data-label="Actions" class="action-col">
                <button class="icon-btn" (click)="showDetailsModal(employee.id!)" title="View">
                  <i class="bi bi-eye-fill" style="font-size:18px"></i>
                </button>

                <button class="icon-btn" (click)="showEditModal(employee.id!)" title="Edit">
                  <i class="bi bi-pencil-square" style="font-size:18px"></i>
                </button>

                <button class="icon-btn delete" (click)="onDelete(employee.id)" title="Delete">
                  <i class="bi bi-trash-fill" style="font-size:18px; color: #c33;"></i>
                </button>
              </td>
            </tr>

            <!-- EMPTY STATE -->
            <tr *ngIf="employees.length === 0">
              <td colspan="7" class="empty-state">No employees found.</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- PAGINATION -->
      <div class="pagination-controls">
        <button (click)="onPageChange(currentPage - 1)" [disabled]="currentPage === 1">
          &laquo; Previous
        </button>

        <span>Page {{ currentPage }} of {{ totalPages }}</span>

        <button (click)="onPageChange(currentPage + 1)" [disabled]="currentPage === totalPages">
          Next &raquo;
        </button>
      </div>
    </div>

    <!-- ADD EMPLOYEE MODAL -->
    <div *ngIf="showAddEmployeeModal" class="modal-overlay">
      <div class="modal-card">
        <app-employee-create
          (closeModal)="showAddEmployeeModal = false"
          (employeeAdded)="onEmployeeAdded()"
        ></app-employee-create>
      </div>
    </div>

    <!-- EDIT MODAL -->
    <div *ngIf="showEditEmployeeModal" class="modal-overlay">
      <div class="modal-card modal-fixed">
        <app-employee-edit-modal
          [employeeId]="selectedEmployeeId"
          (closeModal)="showEditEmployeeModal = false"
          (employeeUpdated)="onEmployeeUpdated()"
        ></app-employee-edit-modal>
      </div>
    </div>

    <!-- DETAILS MODAL -->
    <div *ngIf="showDetailsEmployeeModal" class="modal-overlay">
      <div class="modal-card modal-fixed">
        <app-employee-details-modal
          [employeeId]="selectedEmployeeId"
          (closeModal)="showDetailsEmployeeModal = false"
          (editEmployee)="showEditModalFromDetails($event)"
        ></app-employee-details-modal>
      </div>
    </div>
  </main>
</div>
