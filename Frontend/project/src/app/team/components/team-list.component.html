<div class="dashboard-container">
  <app-sidebar></app-sidebar>

  <main class="main-content">
    <div class="team-container">
      <!-- Header -->
      <div class="page-header">
        <div>
          <h1>Teams</h1>
          <p class="subtitle">Manage your organization's teams</p>
        </div>
      </div>

      <!-- Search and Add Button -->
      <div class="search-add-row">
        <div class="search-box">
          <span class="material-icons md-18 search-icon">search</span>
          <input type="text" placeholder="Search teamsâ€¦" [(ngModel)]="searchText" (input)="onSearch()" />
        </div>

        <button class="btn-add-gold" (click)="openCreateModal()">
          <span class="plus-sign">+</span> Add Team
        </button>
      </div>

      <!-- Loading State -->
      <div *ngIf="isLoading" class="loading-state">
        <p>Loading teams...</p>
      </div>

      <!-- Teams Table -->
      <div class="table-wrapper" *ngIf="!isLoading">
        <table class="team-table">
          <thead>
            <tr>
              <th>S.No</th>
              <th>Team Name</th>
              <th>Description</th>
              <th>Total Employees</th>
              <th>Created Date</th>
              <th>Actions</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let team of teams; let i = index">
              <!-- Serial Number -->
              <td data-label="S.No">
                <span class="serial-number">{{ getSerialNumber(i) }}</span>
              </td>


              <!-- Team Name -->
              <td data-label="Team Name">
                <div class="team-name">
                  <span class="material-icons md-18 team-icon">groups</span>
                  <strong>{{ team.teamName }}</strong>
                </div>
              </td>

              <!-- Description -->
              <td data-label="Description">
                <span class="description-text">{{
                  team.description || 'No description'
                  }}</span>
              </td>

              <!-- Total Employees -->
              <td data-label="Total Employees">
                <span class="employee-count">
                  {{ team.employeeCount || 0 }}
                </span>
              </td>

              <!-- Created Date -->
              <td data-label="Created Date">
                {{ team.createdAt | date: 'MMM dd, yyyy' }}
              </td>

              <!-- Actions -->
              <td data-label="Actions" class="action-col">
                <button class="icon-btn view" (click)="openDetailsModal(team.id)" title="View Details">
                  <span class="material-icons md-18">visibility</span>
                </button>

                <button class="icon-btn edit" (click)="openEditModal(team)" title="Edit Team">
                  <span class="material-icons md-18">edit</span>
                </button>

                <button class="icon-btn delete" (click)="onDelete(team.id)" title="Delete Team">
                  <span class="material-icons md-18">delete</span>
                </button>
              </td>
            </tr>

            <!-- Empty State -->
            <tr *ngIf="teams.length === 0">
              <td colspan="7" class="empty-state">
                <div class="empty-state-content">
                  <span class="material-icons empty-icon">group_off</span>
                  <p>No teams found.</p>
                  <p class="empty-subtitle">Create your first team to get started</p>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="pagination-controls" *ngIf="!isLoading && teams.length > 0">
        <button (click)="onPageChange(currentPage - 1)" [disabled]="currentPage === 1">
          &laquo; Previous
        </button>

        <span>Page {{ currentPage }} of {{ totalPages }}</span>

        <button (click)="onPageChange(currentPage + 1)" [disabled]="currentPage === totalPages">
          Next &raquo;
        </button>
      </div>
    </div>

    <!-- Create Team Modal -->
    <div *ngIf="showCreateModal" class="modal-overlay">
      <div class="modal-card">
        <app-team-create-edit [team]="null" (closeModal)="closeCreateModal()"
          (teamSaved)="onTeamCreated()"></app-team-create-edit>
      </div>
    </div>

    <!-- Edit Team Modal -->
    <div *ngIf="showEditModal" class="modal-overlay">
      <div class="modal-card">
        <app-team-create-edit [team]="selectedTeam" (closeModal)="closeEditModal()"
          (teamSaved)="onTeamUpdated()"></app-team-create-edit>
      </div>
    </div>

    <!-- Team Details Modal -->
    <div *ngIf="showDetailsModal" class="modal-overlay">
      <div class="modal-card modal-large">
        <app-team-details [teamId]="selectedTeamId" (closeModal)="closeDetailsModal()"
          (editTeam)="openEditModal($event)"></app-team-details>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <app-delete-confirmation-modal *ngIf="showDeleteModal"
      message="Are you sure you want to delete this team? This action cannot be undone." [isDeleting]="isDeleting"
      (confirm)="confirmDelete()" (cancel)="cancelDelete()">
    </app-delete-confirmation-modal>

    <!-- Toast Notifications -->
    <app-toast></app-toast>
  </main>
</div>