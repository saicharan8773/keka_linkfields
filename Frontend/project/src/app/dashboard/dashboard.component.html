<div class="dashboard-container" [class.sidebar-closed]="!sidebarOpen">
  <app-sidebar (sidebarToggle)="onSidebarToggle($event)"></app-sidebar>
  <main class="main-content">
    <div class="hr-dashboard">
      <div class="dashboard-header">
        <h1 class="title">Analytics Dashboard</h1>
        <p class="subtitle">Insights into your workforce</p>
      </div>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="card-header">
            <div class="icon-container blue">
              <i class="material-icons icon">groups</i>
            </div>
            <span class="trend positive">â†‘ {{ stats.employeeTrend }}%</span>
          </div>
          <h3 class="card-title">Total Employees</h3>
          <p class="card-value">{{ stats.totalEmployees }}</p>
          <p class="card-subtitle">Active workforce</p>
        </div>
        <div class="stat-card">
          <div class="card-header">
            <div class="icon-container purple">
              <i class="material-icons icon">business_center</i>
            </div>
          </div>
          <h3 class="card-title">Departments</h3>
          <p class="card-value">{{ stats.totalDepartments }}</p>
          <p class="card-subtitle">Across organization</p>
        </div>
        <div class="stat-card">
          <div class="card-header">
            <div class="icon-container green">
              <i class="material-icons icon">person_add</i>
            </div>
            <span class="trend positive">â†‘ 12.5%</span>
          </div>
          <h3 class="card-title">New Joinees</h3>
          <p class="card-value">{{ stats.newJoinees }}</p>
          <p class="card-subtitle">This month</p>
        </div>
        <div class="stat-card">
          <div class="card-header">
            <div class="icon-container orange">
              <i class="material-icons icon">trending_up</i>
            </div>
            <span class="trend negative">â†“ 1.2%</span>
          </div>
          <h3 class="card-title">Attrition Rate</h3>
          <p class="card-value">{{ stats.attritionRate }}%</p>
          <p class="card-subtitle">Below industry avg</p>
        </div>
      </div>

      <div class="charts-grid">
        <div class="chart-card">
          <h3 class="chart-title">Employee Growth Trend</h3>
          <div class="chart-container">
            <canvas id="employeeGrowthChart"></canvas>
          </div>
        </div>
        <div class="chart-card">
          <h3 class="chart-title">Department Distribution</h3>
          <div class="chart-container">
            <canvas id="departmentDistributionChart"></canvas>
          </div>
        </div>
        <div class="chart-card">
          <h3 class="chart-title">Hiring vs Exits</h3>
          <div class="chart-container">
            <canvas id="hiringVsExitsChart"></canvas>
          </div>
        </div>
        <div class="chart-card">
          <h3 class="chart-title">
            Employees on Leave ({{ employeesOnLeave.length }})
          </h3>
          <div class="on-leave-container">
            <div class="leave-date-picker">
              <label for="leaveDate">Date:</label>
              <input
                id="leaveDate"
                type="date"
                [(ngModel)]="selectedLeaveDate"
                (change)="fetchEmployeesOnLeave(selectedLeaveDate)"
              />
            </div>
            <div class="avatar-list">
              <div *ngIf="employeesOnLeave.length === 0" class="empty-state">
                <p>No employees on leave for this date</p>
              </div>
              <div
                *ngFor="let emp of employeesOnLeave"
                class="avatar-circle"
                [title]="emp.firstName + ' ' + emp.lastName"
                [style.background-color]="
                  getAvatarBackgroundColor(emp.firstName + ' ' + emp.lastName)
                "
              >
                {{ getInitials(emp.firstName + " " + emp.lastName) }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="events-grid">
        <div class="event-card new-joinee-card">
          <div class="event-header">
            <div class="event-icon-wrapper new-joinee-icon">
              <i class="material-icons icon">person_add</i>
            </div>
            <h3 class="event-title">New Joinees</h3>
          </div>
          <div class="avatar-list">
            <div
              *ngFor="let person of newJoinees"
              class="avatar-item-container"
              (click)="onEventClick(person, 'New Joinee')"
            >
              <div
                class="avatar-circle new-joinee"
                [style.background-color]="getAvatarBackgroundColor(person.name)"
              >
                {{ getInitials(person.name) }}
                <div class="avatar-ring"></div>
              </div>
              <span class="avatar-name">{{ person.name.split(" ")[0] }}</span>
              <span class="avatar-subtitle">{{ person.role }}</span>
            </div>
          </div>
        </div>
        <div class="event-card birthday-card">
          <div class="event-header">
            <div class="event-icon-wrapper birthday-icon">
              <i class="material-icons icon">cake</i>
            </div>
            <h3 class="event-title">Upcoming Birthdays</h3>
          </div>
          <div class="avatar-list">
            <div
              *ngFor="let person of birthdays"
              class="avatar-item-container"
              (click)="onEventClick(person, 'Upcoming Birthday')"
            >
              <div
                class="avatar-circle birthday"
                [style.background-color]="getAvatarBackgroundColor(person.name)"
              >
                {{ getInitials(person.name) }}
                <div class="birthday-badge">ðŸŽ‚</div>
                <div class="avatar-ring"></div>
              </div>
              <span class="avatar-name">{{ person.name.split(" ")[0] }}</span>
              <span class="avatar-subtitle">{{ person.date }}</span>
            </div>
          </div>
        </div>
        <div class="event-card anniversary-card">
          <div class="event-header">
            <div class="event-icon-wrapper anniversary-icon">
              <i class="material-icons icon">emoji_events</i>
            </div>
            <h3 class="event-title">Work Anniversaries</h3>
          </div>
          <div class="avatar-list">
            <div
              *ngFor="let person of anniversaries"
              class="avatar-item-container"
              (click)="onEventClick(person, 'Work Anniversary')"
            >
              <div
                class="avatar-circle anniversary"
                [style.background-color]="getAvatarBackgroundColor(person.name)"
              >
                {{ getInitials(person.name) }}
                <div class="anniversary-badge">{{ person.years }}Y</div>
                <div class="avatar-ring"></div>
              </div>
              <span class="avatar-name">{{ person.name.split(" ")[0] }}</span>
              <span class="avatar-subtitle">{{ person.years }} years</span>
            </div>
          </div>
        </div>
      </div>

      <div class="additional-metrics-grid">
        <div class="metric-card blue-gradient">
          <i class="material-icons metric-icon">schedule</i>
          <h4 class="metric-title">Avg. Tenure</h4>
          <p class="metric-value">3.2 years</p>
        </div>
        <div class="metric-card green-gradient">
          <i class="material-icons metric-icon">track_changes</i>
          <h4 class="metric-title">Goal Achievement</h4>
          <p class="metric-value">87%</p>
        </div>
        <div class="metric-card purple-gradient">
          <i class="material-icons metric-icon">attach_money</i>
          <h4 class="metric-title">Avg. Salary</h4>
          <p class="metric-value">{{ (stats.avgSalary / 1000).toFixed(0) }}K</p>
        </div>
      </div>
    </div>
  </main>
</div>
